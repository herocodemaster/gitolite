From: Jiang Xin <worldhello.net@gmail.com>
Subject: [PATCH] t/debian-initial-config

Use custom gitolite initial config file.

Signed-off-by: Jiang Xin <worldhello.net@gmail.com>

---
 conf/example.gitolite.rc |   18 ++++++++++++------
 src/gl-setup             |   19 +++++++++++++++++--
 2 个文件被修改，插入 29 行(+)，删除 8 行(-)

diff --git a/conf/example.gitolite.rc b/conf/example.gitolite.rc
index 9231436..9955e6d 100644
--- a/conf/example.gitolite.rc
+++ b/conf/example.gitolite.rc
@@ -44,19 +44,25 @@ $GL_NO_DAEMON_NO_GITWEB = 0;
 # ------------------------------------------------------------------------------
 # $GL_ALL_READ_ALL = 0;
 $GIT_PATH="";
-$GL_GITCONFIG_KEYS = "";
-# $GL_GITCONFIG_WILD = 0;
+# Available git config settings for repo. Keys gitolite.mirror.* is used for repo mirror
+$GL_GITCONFIG_KEYS = "gitolite.mirror.* core\\.logAllRefUpdates core\\..*compression hooks\\..* hooks\\..*";
+# Warning user if set git config against wild repo.
+$GL_GITCONFIG_WILD = 1;
 $GL_NO_CREATE_REPOS = 0;
 $GL_NO_SETUP_AUTHKEYS = 0;
 # $GL_WILDREPOS_DEFPERMS = 'R @all';
 $HTPASSWD_FILE = "";
 $RSYNC_BASE = "";
-$SVNSERVE = "";
+# Gitolite can also be used to gate access (though not at a fine grained level)
+# to SVN if needed, passing authentication information on to `svnserve`. 
+$SVNSERVE = "/usr/bin/svnserve -r /opt/svn/svnroot/ -t --tunnel-user=%u";
 # $UPDATE_CHAINS_TO = "hooks/update.secondary";
 # $ADMIN_POST_UPDATE_CHAINS_TO = "hooks/post-update.secondary";
-# $GL_ADC_PATH = "";
+# Admin defined command path
+$GL_ADC_PATH = $ENV{HOME} . "/adc-bin";
 # $GL_GET_MEMBERSHIPS_PGM = "/usr/local/bin/expand-ldap-user-to-groups"
-# $GL_HTTP_ANON_USER = "mob";
+# Unauthenticated HTTP users are actually authenticated as this user.
+$GL_HTTP_ANON_USER = "mob";
 
 # ------------------------------------------------------------------------------
 # less used/changed variables
@@ -72,7 +78,7 @@ $GL_WILDREPOS_PERM_CATS = "READERS WRITERS";
 # rarely changed variables
 # ------------------------------------------------------------------------------
 $GL_LOGT="$GL_ADMINDIR/logs/gitolite-%y-%m.log";
-# $GL_PERFLOGT="$GL_ADMINDIR/logs/perf-gitolite-%y-%m.log";
+$GL_PERFLOGT="$GL_ADMINDIR/logs/perf-gitolite-%y-%m.log";
 
 # ------------------------------------------------------------------------------
 # variables that should NOT be changed after the install step completes
diff --git a/src/gl-setup b/src/gl-setup
index fd8357b..f2819e6 100755
--- a/src/gl-setup
+++ b/src/gl-setup
@@ -111,11 +111,26 @@ gl-install -q
 
 [ -f $GL_ADMINDIR/conf/gitolite.conf ] || {
     cat <<EOF | cut -c9- > $GL_ADMINDIR/conf/gitolite.conf
+        @admin = $admin_name
+
         repo    gitolite-admin
-                RW+     =   $admin_name
+                RW+     =   @admin
+
+        repo    users/CREATOR/[a-zA-Z].*
+                C   =  @all
+                RW+ =  CREATOR
+                RW  =  WRITERS
+                R   =  READERS @admin
 
         repo    testing
-                RW+     =   @all
+                #config hooks.mailinglist  = testing-commit@list.foo.bar
+                #config hooks.announcelist = testing-commit@list.foo.bar
+                RW+CD                     = @admin
+                -     refs/tags/v[0-9]    = @all
+                RWC   refs/tags/          = @all
+                RW    master              = @all
+                RW+CD refs/heads/u/USER/  = @all
+
 EOF
 }
 [ -n "$pubkey_file" ] && cp $pubkey_file $GL_ADMINDIR/keydir
-- 
tg: (39aeae1..) t/debian-initial-config (depends on: master)
