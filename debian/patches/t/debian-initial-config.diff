From: Jiang Xin <worldhello.net@gmail.com>
Subject: [PATCH] t/debian-initial-config

Use custom gitolite initial config file.

Signed-off-by: Jiang Xin <worldhello.net@gmail.com>

---
 conf/example.gitolite.rc |   13 +++++++++----
 src/gl-setup             |   18 ++++++++++++++++--
 2 个文件被修改，插入 25 行(+)，删除 6 行(-)

diff --git a/conf/example.gitolite.rc b/conf/example.gitolite.rc
index 6ffaa87..3ae5eb4 100644
--- a/conf/example.gitolite.rc
+++ b/conf/example.gitolite.rc
@@ -46,17 +46,22 @@ $GL_NO_DAEMON_NO_GITWEB = 0;
 # ------------------------------------------------------------------------------
 # $GL_ALL_READ_ALL = 0;
 $GIT_PATH="";
-$GL_GITCONFIG_KEYS = "";
+# Available git config settings for repo. Keys gitolite.mirror.* is used for repo mirror
+$GL_GITCONFIG_KEYS = "gitolite.mirror.* core\\.logAllRefUpdates core\\..*compression hooks\\..*";
 $GL_NO_CREATE_REPOS = 0;
 $GL_NO_SETUP_AUTHKEYS = 0;
 # $GL_WILDREPOS_DEFPERMS = 'R @all';
 $HTPASSWD_FILE = "";
 $RSYNC_BASE = "";
-$SVNSERVE = "";
+# Gitolite can also be used to gate access (though not at a fine grained level)
+# to SVN if needed, passing authentication information on to `svnserve`. 
+$SVNSERVE = "/usr/bin/svnserve -r /opt/svn/svnroot/ -t --tunnel-user=%u";
 # $UPDATE_CHAINS_TO = "hooks/update.secondary";
 # $ADMIN_POST_UPDATE_CHAINS_TO = "hooks/post-update.secondary";
-# $GL_ADC_PATH = "";
+# Admin defined command path
+$GL_ADC_PATH = $ENV{HOME} . "/adc-bin";
 # $GL_GET_MEMBERSHIPS_PGM = "/usr/local/bin/expand-ldap-user-to-groups"
+# Unauthenticated HTTP users are actually authenticated as this user.
 # $GL_HTTP_ANON_USER = "mob";
 # $GL_REF_OR_FILENAME_PATT=qr(^[0-9a-zA-Z][0-9a-zA-Z._\@/+ :,-]*$);
 
@@ -75,7 +80,7 @@ $GL_WILDREPOS_PERM_CATS = "READERS WRITERS";
 # rarely changed variables
 # ------------------------------------------------------------------------------
 $GL_LOGT="$GL_ADMINDIR/logs/gitolite-%y-%m.log";
-# $GL_PERFLOGT="$GL_ADMINDIR/logs/perf-gitolite-%y-%m.log";
+$GL_PERFLOGT="$GL_ADMINDIR/logs/perf-gitolite-%y-%m.log";
 
 # ------------------------------------------------------------------------------
 # variables that should NOT be changed after the install step completes
diff --git a/src/gl-setup b/src/gl-setup
index 1970d93..5075f3b 100755
--- a/src/gl-setup
+++ b/src/gl-setup
@@ -162,11 +162,25 @@ gl-install -q
 
 [ -f $GL_ADMINDIR/conf/gitolite.conf ] || {
     echo "
+        @admin = $admin_name
+
         repo    gitolite-admin
-                RW+     =   $admin_name
+                RW+     =   @admin
+
+        repo    users/CREATOR/[a-zA-Z].*
+                C   =  @all
+                RW+ =  CREATOR
+                RW  =  WRITERS
+                R   =  READERS @admin
 
         repo    testing
-                RW+     =   @all
+                #config hooks.mailinglist  = testing-commit@list.foo.bar
+                #config hooks.announcelist = testing-commit@list.foo.bar
+                RW+CD                     = @admin
+                -     refs/tags/v[0-9]    = @all
+                RWC   refs/tags/          = @all
+                RW    master              = @all
+                RW+CD refs/heads/u/USER/  = @all
     " | cut -c9- > $GL_ADMINDIR/conf/gitolite.conf
 }
 [ -n "$pubkey_file" ] && cp $pubkey_file $GL_ADMINDIR/keydir
-- 
tg: (d59bc35..) t/debian-initial-config (depends on: upstream)
